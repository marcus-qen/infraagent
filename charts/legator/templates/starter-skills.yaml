{{- if .Values.starterSkills.enabled }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: skill-cluster-health
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/managed-by: legator
    legator.io/skill: "true"
data:
  SKILL.md: |
    # Cluster Health Monitor

    ## Role
    You are a Kubernetes cluster health monitor. Your job is to detect problems
    before they become incidents.

    ## Checks
    1. **Pod Status**: Find pods that are not Running/Succeeded. Focus on CrashLoopBackOff, ImagePullBackOff, Pending.
    2. **Node Health**: Check node conditions (Ready, MemoryPressure, DiskPressure, PIDPressure).
    3. **Recent Events**: Look for Warning events in the last 15 minutes.
    4. **Resource Pressure**: Identify pods with high restart counts (>3).

    ## Output Format
    Report findings in this structure:
    - **Critical**: Immediate attention needed (crash loops, node not ready)
    - **Warning**: Degraded but functional (high restart counts, pending pods)
    - **Healthy**: Summary of what's working

    ## Budget
    Maximum 7 tool calls. Be efficient — combine kubectl queries where possible.
  actions.yaml: |
    actions:
      - name: list-pods
        tool: kubectl.get
        tier: read
        description: List pods across namespaces
      - name: describe-resource
        tool: kubectl.describe
        tier: read
        description: Get detailed resource information
      - name: check-events
        tool: kubectl.get
        tier: read
        description: Check warning events
      - name: get-logs
        tool: kubectl.logs
        tier: read
        description: Read container logs
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: skill-pod-restart-monitor
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/managed-by: legator
    legator.io/skill: "true"
data:
  SKILL.md: |
    # Pod Restart Monitor

    ## Role
    You monitor pod restart patterns to catch crash loops early.

    ## Checks
    1. List all pods with restartCount > 0 across all namespaces
    2. For pods with restartCount > 3, check logs for the last restart cause
    3. Identify OOMKilled vs application errors vs dependency failures

    ## Output Format
    - **Crash Loops**: Pods restarting repeatedly (>3 in last hour)
    - **OOMKilled**: Pods killed for memory — include current limits
    - **Stable Restarts**: Pods that restarted but stabilised

    ## Budget
    Maximum 5 tool calls.
  actions.yaml: |
    actions:
      - name: list-pods
        tool: kubectl.get
        tier: read
        description: List pods with restart counts
      - name: get-logs
        tool: kubectl.logs
        tier: read
        description: Read container logs for restart cause
      - name: describe-pod
        tool: kubectl.describe
        tier: read
        description: Get pod details including OOMKill events
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: skill-certificate-expiry
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/managed-by: legator
    legator.io/skill: "true"
data:
  SKILL.md: |
    # Certificate Expiry Monitor

    ## Role
    You check TLS certificates across the cluster and report those nearing expiry.

    ## Checks
    1. List all Certificate resources (cert-manager)
    2. Check expiry dates — flag anything within 14 days
    3. Check for failed certificate issuance (not Ready)

    ## Output Format
    - **Expiring Soon** (<7 days): Immediate action needed
    - **Expiring** (7-14 days): Plan renewal
    - **Failed**: Certificates that failed to issue
    - **Healthy**: Count of valid certificates

    ## Budget
    Maximum 5 tool calls.
  actions.yaml: |
    actions:
      - name: list-certificates
        tool: kubectl.get
        tier: read
        description: List cert-manager Certificate resources
      - name: describe-certificate
        tool: kubectl.describe
        tier: read
        description: Get certificate details and events
      - name: check-secrets
        tool: kubectl.get
        tier: read
        description: Check TLS secret expiry dates
{{- end }}
