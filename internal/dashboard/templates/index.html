{{template "layout" .}}
{{define "content"}}
<h1>Dashboard</h1>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-value">{{.ReadyCount}}/{{.AgentCount}}</div>
    <div class="stat-label">Agents Ready</div>
  </div>
  <div class="stat-card">
    <div class="stat-value">{{.TotalRuns}}</div>
    <div class="stat-label">Total Runs</div>
  </div>
  <div class="stat-card">
    <div class="stat-value">{{printf "%.1f" .SuccessRate}}%</div>
    <div class="stat-label">Success Rate</div>
  </div>
  <div class="stat-card {{if gt .PendingApprovals 0}}stat-alert{{end}}">
    <div class="stat-value">{{.PendingApprovals}}</div>
    <div class="stat-label">Pending Approvals</div>
  </div>
</div>

<h2>Recent Runs</h2>
<table class="data-table">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Agent</th>
      <th>Trigger</th>
      <th>Tokens</th>
      <th>Duration</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody hx-get="/api/runs-table" hx-trigger="every 30s" hx-swap="innerHTML">
    {{range .RecentRuns}}
    <tr>
      <td>{{statusIcon (print .Status.Phase)}}</td>
      <td><a href="/runs/{{.Name}}">{{.Name}}</a></td>
      <td><a href="/agents/{{.Spec.AgentRef}}">{{.Spec.AgentRef}}</a></td>
      <td>{{.Spec.Trigger}}</td>
      <td>{{with .Status.Usage}}{{tokensStr .TokensIn .TokensOut}}{{else}}—{{end}}</td>
      <td>{{with .Status.Usage}}{{durationMs .WallClockMs}}{{else}}—{{end}}</td>
      <td>{{timeAgo .CreationTimestamp.Time}}</td>
    </tr>
    {{else}}
    <tr><td colspan="7" class="empty">No runs yet</td></tr>
    {{end}}
  </tbody>
</table>
{{end}}
