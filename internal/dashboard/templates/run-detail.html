{{template "layout" .}}
{{define "content"}}
<h1>{{statusIcon (print .Run.Status.Phase)}} {{.Run.Name}}</h1>

<div class="detail-grid">
  <div class="detail-card">
    <h3>Run Info</h3>
    <dl>
      <dt>Agent</dt>
      <dd><a href="/agents/{{.Run.Spec.AgentRef}}">{{.Run.Spec.AgentRef}}</a></dd>
      <dt>Phase</dt>
      <dd>{{.Run.Status.Phase}}</dd>
      <dt>Trigger</dt>
      <dd>{{.Run.Spec.Trigger}}</dd>
      <dt>Model</dt>
      <dd>{{.Run.Spec.ModelUsed}}</dd>
      <dt>Iterations</dt>
      <dd>{{with .Run.Status.Usage}}{{.Iterations}}{{else}}0{{end}}</dd>
      <dt>Duration</dt>
      <dd>{{with .Run.Status.Usage}}{{durationMs .WallClockMs}}{{else}}â€”{{end}}</dd>
      <dt>Tokens</dt>
      <dd>{{with .Run.Status.Usage}}{{tokensStr .TokensIn .TokensOut}}{{else}}â€”{{end}}</dd>
    </dl>
  </div>
  <div class="detail-card">
    <h3>Guardrails</h3>
    {{with .Run.Status.Guardrails}}
    <dl>
      <dt>Autonomy Ceiling</dt>
      <dd><code>{{.AutonomyCeiling}}</code></dd>
      <dt>Checks Performed</dt>
      <dd>{{.ChecksPerformed}}</dd>
      <dt>Actions Blocked</dt>
      <dd>{{.ActionsBlocked}}</dd>
      <dt>Escalations</dt>
      <dd>{{.EscalationsTriggered}}</dd>
    </dl>
    {{else}}
    <p class="empty">No guardrail data</p>
    {{end}}
  </div>
</div>

{{if .Run.Status.Actions}}
<h2>Actions ({{len .Run.Status.Actions}})</h2>
<table class="data-table">
  <thead>
    <tr>
      <th>#</th>
      <th></th>
      <th>Tool</th>
      <th>Tier</th>
      <th>Target</th>
      <th>Result</th>
    </tr>
  </thead>
  <tbody>
    {{range .Run.Status.Actions}}
    <tr>
      <td>{{.Seq}}</td>
      <td>{{if eq (print .Status) "blocked"}}ðŸš«{{else}}âœ…{{end}}</td>
      <td><code>{{.Tool}}</code></td>
      <td>{{.Tier}}</td>
      <td>{{truncate .Target 60}}</td>
      <td>{{if eq (print .Status) "blocked"}}<span class="blocked">blocked</span>{{else}}{{truncate .Result 80}}{{end}}</td>
    </tr>
    {{end}}
  </tbody>
</table>
{{end}}

{{if .Run.Status.Findings}}
<h2>Findings ({{len .Run.Status.Findings}})</h2>
<div class="findings">
  {{range .Run.Status.Findings}}
  <div class="finding {{severityClass .Severity}}">
    <strong>{{.Severity}}</strong>: {{.Description}}
    {{if .Resource}}<br><code>{{.Resource}}</code>{{end}}
  </div>
  {{end}}
</div>
{{end}}

{{if .Run.Status.Report}}
<h2>Report</h2>
<pre class="report">{{.Run.Status.Report}}</pre>
{{end}}

{{if .Run.Status.Error}}
<h2>Error</h2>
<pre class="error">{{.Run.Status.Error}}</pre>
{{end}}
{{end}}
