{{template "layout" .}}
{{define "content"}}
<h1>Agents</h1>

<table class="data-table">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Autonomy</th>
      <th>Schedule</th>
      <th>Runs</th>
      <th>Failures</th>
      <th>Last Run</th>
    </tr>
  </thead>
  <tbody hx-get="/api/agents-table" hx-trigger="every 30s" hx-swap="innerHTML">
    {{range .Agents}}
    <tr>
      <td>{{statusIcon (print .Status.Phase)}}</td>
      <td><a href="/agents/{{.Name}}">{{.Name}}</a></td>
      <td><code>{{.Spec.Guardrails.Autonomy}}</code></td>
      <td>
        {{if .Spec.Schedule.Cron}}{{.Spec.Schedule.Cron}}{{end}}
        {{if .Spec.Schedule.Interval}}{{.Spec.Schedule.Interval}}{{end}}
      </td>
      <td>{{.Status.RunCount}}</td>
      <td>{{.Status.ConsecutiveFailures}}</td>
      <td>{{if .Status.LastRunTime}}{{timeAgo .Status.LastRunTime.Time}}{{else}}never{{end}}</td>
    </tr>
    {{else}}
    <tr><td colspan="7" class="empty">No agents configured</td></tr>
    {{end}}
  </tbody>
</table>
{{end}}
